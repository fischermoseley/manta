name: build_icestick_examples
on: [push]
jobs:
  install-toolchain:
    runs-on: ubuntu-latest
    steps:
    - name: install yosys
      run: |
        sudo apt install build-essential clang bison flex 
        sudo apt install libreadline-dev gawk tcl-dev libffi-dev git
	      sudo apt install graphviz xdot pkg-config python3 libboost-system-dev
	      sudo apt install libboost-python-dev libboost-filesystem-dev zlib1g-dev

        git clone https://github.com/cliffordwolf/yosys.git yosys
        cd yosys
        make -j$(nproc)
        sudo make install

    - name: install nextpnr
      run: |
        sudo apt install libboost-all-dev libeigen3-dev
        git clone git@github.com:YosysHQ/nextpnr.git nextpnr
        cmake . -DARCH=ice40
        make -j$(nproc)
        sudo make install

    - name: install icestorm
      run: |
        git clone https://github.com/cliffordwolf/icestorm.git icestorm
        cd icestorm
        make -j$(nproc)
        sudo make install
  
  uart:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: build uart
        run: |
          cd examples/icestick/uart
          make